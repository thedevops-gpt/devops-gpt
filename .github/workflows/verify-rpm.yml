name: Verify RPM

on:
  push:
    branches:
      - main
  pull_request:

jobs:
  verify-rpm:
    runs-on: ubuntu-latest
    steps:
      # Step 1: Checkout the code
      - name: Checkout code
        uses: actions/checkout@v3

      # Step 2: Install necessary tools
      - name: Install RPM tools
        run: |
          sudo apt-get update
          sudo apt-get install -y rpm

      # Step 3: Verify the RPM file exists
      - name: Verify RPM file exists
        run: |
          if [[ ! -f devops-gpt-0.0.1.x86_64.rpm ]]; then
            echo "RPM file not found!"
            exit 1
          fi
          
      # Step 4: Verify the RPM signature (if applicable)
      - name: Verify RPM signature
        run: |
          rpm --checksig devops-gpt-0.0.1.x86_64.rpm

      # Step 5: Test RPM installation (optional)
      - name: Install and test RPM
        run: |
          sudo rpm -ivh devops-gpt-0.0.1.x86_64.rpm
          # Run custom commands to verify functionality
          # For example, check if the installed service or application works as expected

      # Step 6: Cleanup (optional)
      - name: Cleanup
        run: |
          sudo rpm -e devops-gpt-0.0.1.x86_64.rpm
          # Additional cleanup if necessary
